<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Air Hockey Solitaire</title>
  <link rel="stylesheet" href="./style.css" />
  <meta name="theme-color" content="#0b0f14" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="manifest" href="./manifest.json" />
  <link rel="icon" href="./icon-192.png" sizes="192x192" />
  <link rel="icon" href="./icon-512.png" sizes="512x512" />
  <link rel="apple-touch-icon" href="./icon-192.png" />
</head>
<body>
  <header class="topbar">
  <div class="titleRow">
   <img id="logoBtn" class="appLogo" src="logo.png" alt="Air Hockey Solitaire" />
    <div class="titleText">
      <div class="appTitle">Air Hockey Solitaire</div>
      <div class="appSub">Klondike - 1 draw - timed</div>
    </div>
  </div>

  <div class="toolsRow" id="toolsRow">
    <div class="pill">Moves: <span id="moves">0</span></div>
    <div class="pill"><span id="timer">00:00</span></div>

    <button id="shareBtn" class="pill">Share</button>
    <button id="undoBtn" class="pill">Undo</button>
    <button id="autoBtn" class="pill">Auto</button>
    <button id="newGameBtn" class="pill">New Game</button>
    <button id="settingsBtn" class="pill" aria-label="Settings">⚙</button>
  </div>
</header>

  <main class="table" id="table">
    <section class="row top">
      <div class="pile-group left">
        <div class="pile-wrap">
          <div class="pile-label">Stock</div>
          <div class="pile stock" id="stock" data-pile="stock" aria-label="Stock pile"></div>
        </div>
        <div class="pile-wrap">
          <div class="pile-label">Waste</div>
          <div class="pile waste" id="waste" data-pile="waste" aria-label="Waste pile"></div>
        </div>
      </div>

      <div class="pile-group right">
        <div class="pile-wrap">
          <div class="pile-label">♠</div>
          <div class="pile foundation" id="foundation-S" data-pile="foundation" data-suit="S" aria-label="Spades foundation"></div>
        </div>
        <div class="pile-wrap">
          <div class="pile-label">♥</div>
          <div class="pile foundation" id="foundation-H" data-pile="foundation" data-suit="H" aria-label="Hearts foundation"></div>
        </div>
        <div class="pile-wrap">
          <div class="pile-label">♦</div>
          <div class="pile foundation" id="foundation-D" data-pile="foundation" data-suit="D" aria-label="Diamonds foundation"></div>
        </div>
        <div class="pile-wrap">
          <div class="pile-label">♣</div>
          <div class="pile foundation" id="foundation-C" data-pile="foundation" data-suit="C" aria-label="Clubs foundation"></div>
        </div>
      </div>
    </section>

    <section class="row tableau" id="tableau">
      <!-- 7 columns injected by JS -->
    </section>
  </main>

  <div class="settings hidden" id="settings">
    <div class="settings-card">
      <div class="settings-head">
        <div class="settings-title">Settings</div>
        <button class="btn" id="closeSettingsBtn">Close</button>
      </div>
      
      <div class="settings-block">
        <div class="settings-label">Sound</div>
        <label class="check"><input type="checkbox" id="soundMaster"> Enable sound</label>
        <label class="check"><input type="checkbox" id="soundShuffle"> Shuffle</label>
        <label class="check"><input type="checkbox" id="soundPlace"> Place</label>
        <label class="check"><input type="checkbox" id="soundWin"> Win</label>
      </div>

      <div class="settings-block">
        <div class="settings-label">Card Back</div>

        <select id="backSelect" class="select"></select>
        <div class="settings-help">Drop new PNGs into cards/backs to add more.</div>
      </div>
    </div>
  </div>


  <!-- Win overlay -->
  <div class="overlay hidden" id="winOverlay" role="dialog" aria-modal="true">
    <canvas id="confettiCanvas"></canvas>
    <div class="win-card">
      <div class="win-title">You won</div>
      <div class="win-sub">Nice hands, fellow human.</div>
      <div class="win-actions">
        <button class="btn primary" id="playAgainBtn">Play Again</button>
        <button class="btn" id="winShareBtn">Brag</button>
      </div>
    </div>
  </div>

<!-- Share overlay -->
<div class="overlay hidden" id="shareOverlay" role="dialog" aria-modal="true">
  <div class="share-card">
    <div class="share-title">Share Air Hockey Solitaire</div>

    <img
      src="./air-hockey-solitaire-qr.png"
      alt="QR code for Air Hockey Solitaire"
      class="share-qr"
    />

    <div class="share-url">
      https://petesimple.github.io/solitaire/
    </div>

    <div class="share-actions">
      <button class="btn" id="copyLinkBtn">Copy Link</button>
      <button class="btn primary" id="nativeShareBtn">Share</button>
      <button class="btn" id="closeShareBtn">Close</button>
    </div>
  </div>
</div>
  
  <script src="./cards/backs/backs.js"></script>
  <script src="./main.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js').catch(console.warn);
      });
    }
  </script>

  <script>
(() => {
  const SHARE_URL = 'https://petesimple.github.io/solitaire/';

  const logoBtn = document.getElementById('logoBtn');
  const shareBtn = document.getElementById('shareBtn');

  const shareOverlay = document.getElementById('shareOverlay');
  const closeShareBtn = document.getElementById('closeShareBtn');
  const copyLinkBtn = document.getElementById('copyLinkBtn');
  const nativeShareBtn = document.getElementById('nativeShareBtn');

  function openShare(){
    if(!shareOverlay) return;
    shareOverlay.classList.remove('hidden');
  }
  function closeShare(){
    if(!shareOverlay) return;
    shareOverlay.classList.add('hidden');
  }

  // Open from either logo tap OR Share button
  if(logoBtn) logoBtn.addEventListener('click', openShare);
  if(shareBtn) shareBtn.addEventListener('click', openShare);

  if(closeShareBtn) closeShareBtn.addEventListener('click', closeShare);

  // Tap outside card closes
  if(shareOverlay){
    shareOverlay.addEventListener('click', (e) => {
      if(e.target === shareOverlay) closeShare();
    });
  }

  // Copy link
  if(copyLinkBtn){
    copyLinkBtn.addEventListener('click', async () => {
      try{
        await navigator.clipboard.writeText(SHARE_URL);
        const prev = copyLinkBtn.textContent;
        copyLinkBtn.textContent = 'Copied!';
        setTimeout(()=> copyLinkBtn.textContent = prev, 1200);
      }catch(e){
        // iOS can be picky - fallback prompt
        window.prompt('Copy this link:', SHARE_URL);
      }
    });
  }

  // Native share (mobile)
  if(nativeShareBtn){
    if(navigator.share){
      nativeShareBtn.addEventListener('click', async () => {
        try{
          await navigator.share({
            title: 'Air Hockey Solitaire',
            text: 'Play Air Hockey Solitaire',
            url: SHARE_URL
          });
        }catch(e){}
      });
    } else {
      nativeShareBtn.style.display = 'none';
    }
  }

  // Esc closes
  window.addEventListener('keydown', (e) => {
    if(e.key === 'Escape') closeShare();
  });
  // Win share brag
const winShareBtn = document.getElementById('winShareBtn');

function getWinStats(){
  const movesText = (document.getElementById('moves')?.textContent || '').trim();
  const timerText = (document.getElementById('timer')?.textContent || '').trim();

  // In your UI moves is just a number in #moves, timer is already formatted
  const moves = movesText || '0';
  const time = timerText || '00:00';

  return { moves, time };
}

function buildBragText(){
  const { moves, time } = getWinStats();

  // Optional: date stamp like Wordle does
  const d = new Date();
  const stamp = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;

  return [
    `Air Hockey Solitaire`,
    `Win on ${stamp}`,
    `Time: ${time}`,
    `Moves: ${moves}`,
    ``,
    `Play it: https://petesimple.github.io/solitaire/`
  ].join('\n');
}

async function shareOrCopy(text){
  // Prefer native share when available
  if (navigator.share) {
    try{
      await navigator.share({
        title: 'Air Hockey Solitaire',
        text,
        url: 'https://petesimple.github.io/solitaire/'
      });
      return;
    }catch(e){}
  }

  // Clipboard fallback
  try{
    await navigator.clipboard.writeText(text);
    // Tiny feedback: reuse win button label if you want
    if(winShareBtn){
      const prev = winShareBtn.textContent;
      winShareBtn.textContent = 'Copied!';
      setTimeout(()=> winShareBtn.textContent = prev, 1200);
    }
  }catch(e){
    window.prompt('Copy this brag text:', text);
  }
}

if(winShareBtn){
  winShareBtn.addEventListener('click', () => {
    const brag = buildBragText();
    shareOrCopy(brag);
  });
}
})();
</script>
  
  
</body>
</html>
